Bootstrap: docker
From: rocker/geospatial:4.2.0

%environment
    export PATH=${PATH}:/usr/local/texlive/bin/x86_64-linux

%post
    export PATH=$PATH:/usr/local/texlive/bin/x86_64-linux
    set -o errexit
    wget https://raw.githubusercontent.com/Bioconductor/bioconductor_docker/RELEASE_3_15/bioc_scripts/install_bioc_sysdeps.sh
    # use slightly-older apt install versions due to some overlap/conflict with
    # apt-installed python packages from rocker/geospatial
    sed -i'' 's/^pip3 install scikit-learn pandas pyyaml/apt install -y --no-install-recommends python3-sklearn python3-pandas python3-yaml/' install_bioc_sysdeps.sh
    sh install_bioc_sysdeps.sh
    rm install_bioc_sysdeps.sh

    # reticulate
    /rocker_scripts/install_python.sh

    # Install default & yihui TinyTex latex package sets to allow knit-to-PDF
    # (hopefully in most cases) without installation of additional LaTeX packages,
    # as /usr/local/texlive is read-only in the Singularity image
    # v0.38 is broken w/ CTAN 2022/04/21 (https://github.com/rstudio/tinytex/pull/364); need v0.39
    tlmgr install $(curl https://raw.githubusercontent.com/rstudio/tinytex/v0.39/tools/pkgs-custom.txt | tr '\n' ' ')
    tlmgr install $(curl https://raw.githubusercontent.com/rstudio/tinytex/v0.39/tools/pkgs-yihui.txt | tr '\n' ' ')

%labels
    Author nweeks@g.harvard.edu
